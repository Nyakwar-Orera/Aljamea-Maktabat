---
# ğŸ“š Maktabat al-Jamea Library Dashboard
---

A professional, role-based dashboard built with Flask and seamlessly integrated with Koha ILS. It provides real-time analytics, automated scheduled reports, and secure dashboards for administrators, heads of departments (HODs), and class teachersâ€”enabling data-driven decisions and streamlined library management.

---

## âœ¨ Key Features

### ğŸ” Role-Based Authentication

* Secure login for:

  * **Administrators**
  * **Heads of Departments (HODs)**
  * **Class Teachers**
* Credentials configured via `.env`
* Password reset via email verification

### ğŸ“Š Interactive Dashboards

#### ğŸ§­ Admin Dashboard

* Global KPIs: patrons, issues, fines, and most borrowed titles
* Monthly/yearly borrowing trends
* Manage users, mappings, and email schedules

#### ğŸ‘©â€ğŸ« Teacher Dashboard

* Class-specific statistics
* Student borrowing histories
* Download class performance reports

#### ğŸ›ï¸ HOD Dashboard

* Department-wide analytics
* Identify top-performing classes and popular books
* Generate department summary reports

### ğŸ“‘ Reports & Analytics

* Class, department, and student-level reports
* Borrower photos and detailed history
* Export to **PDF**, **Excel**, or **ODS**

### ğŸ“§ Automated Email Reports

* Monthly class reports â†’ sent to **teachers**
* Department summaries â†’ sent to **HODs**
* Configurable scheduler (**daily**, **weekly**, or **monthly**)
* Professional, responsive HTML email templates

### âš™ï¸ Admin Controls

* Manage **studentâ€“classâ€“teacher mappings**
* Assign and update **department heads**
* Configure **database**, **email**, and **scheduler**
* Monitor all **background jobs and logs**

---

## ğŸ–¼ï¸ Dashboard Preview

| Role                        | Screenshot                                                     |
| --------------------------- | -------------------------------------------------------------- |
| ğŸ§­ **Admin Dashboard**      | ![Admin Dashboard](static/screenshots/admin_dashboard.png)     |
| ğŸ›ï¸ **HOD Dashboard**       | ![HOD Dashboard](static/screenshots/hod_dashboard.png)         |
| ğŸ‘©â€ğŸ« **Teacher Dashboard** | ![Teacher Dashboard](static/screenshots/teacher_dashboard.png) |
| ğŸ§¾ **Reports View**         | ![Reports View](static/screenshots/reports_view.png)           |
| ğŸ” **Login Page**           | ![Login Page](static/screenshots/login_page.png)               |


---

## ğŸ—‚ï¸ Project Structure

```
maktabat/
â”‚â”€â”€ app.py                     # Flask app entry point
â”‚â”€â”€ config.py                  # Environment configuration
â”‚â”€â”€ db_app.py                  # Local SQLite (users, mappings, settings)
â”‚â”€â”€ db_koha.py                 # Koha MySQL DB connection
â”‚â”€â”€ scheduler.py               # APScheduler setup
â”‚
â”‚â”€â”€ email_utils/               # Email sending utilities
â”‚â”€â”€ services/
â”‚   â”œâ”€â”€ koha_queries.py        # SQL queries for Koha
â”‚   â”œâ”€â”€ reporting.py           # Report generation logic
â”‚   â””â”€â”€ exports.py             # PDF, Excel, ODS export helpers
â”‚
â”‚â”€â”€ tasks/
â”‚   â”œâ”€â”€ scheduler.py           # Background job control
â”‚   â””â”€â”€ monthly_reports.py     # Automated email reports
â”‚
â”‚â”€â”€ routes/
â”‚   â”œâ”€â”€ admin.py               # Admin routes
â”‚   â”œâ”€â”€ dashboard.py           # Admin dashboard routes
â”‚   â”œâ”€â”€ hod_dashboard.py       # HOD dashboard routes
â”‚   â”œâ”€â”€ teacher_dashboard.py   # Teacher dashboard routes
â”‚   â”œâ”€â”€ reports.py             # Report APIs
â”‚   â”œâ”€â”€ student.py             # Student views
â”‚   â”œâ”€â”€ auth.py                # Authentication logic
â”‚   â””â”€â”€ password_reset.py      # Password reset flow
â”‚
â”‚â”€â”€ templates/
â”‚   â”œâ”€â”€ base.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â”œâ”€â”€ hod_dashboard.html
â”‚   â”œâ”€â”€ teacher_dashboard.html
â”‚   â”œâ”€â”€ reports.html
â”‚   â”œâ”€â”€ student.html
â”‚   â”œâ”€â”€ settings.html
â”‚   â”œâ”€â”€ forgot.html
â”‚   â”œâ”€â”€ reset.html
â”‚   â””â”€â”€ emails/
â”‚       â”œâ”€â”€ class_report_email.html
â”‚       â”œâ”€â”€ department_report_email.html
â”‚       â””â”€â”€ password_reset_email.html
â”‚
â”‚â”€â”€ static/
â”‚   â”œâ”€â”€ css/style.css
â”‚   â”œâ”€â”€ js/script.js
â”‚   â””â”€â”€ screenshots/            # Add dashboard preview images here
â”‚
â”‚â”€â”€ appdata.db                 # Local SQLite (auto-created)
â”‚â”€â”€ appdata_init.py            # Initialize local DB
â”‚â”€â”€ requirements.txt
â”‚â”€â”€ .env
â”‚â”€â”€ README.md
```

---

## âš™ï¸ Installation

### 1ï¸âƒ£ Clone the Repository

```bash
git clone https://github.com/Nyakwar-Orera/Aljamea-Maktabat.git
cd Aljamea-Maktabat
```

### 2ï¸âƒ£ Create a Virtual Environment

```bash
python -m venv venv
source venv/bin/activate   # Linux/Mac
venv\Scripts\activate      # Windows
```

### 3ï¸âƒ£ Install Dependencies

```bash
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt
```

### 4ï¸âƒ£ Configure Environment Variables

Create a `.env` file in the project root:

```bash
# Flask
SECRET_KEY=super_secret_key_here

# Admin login
ADMIN_USER=admin
ADMIN_PASS=adminpass

# Email
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your_email@gmail.com
MAIL_PASSWORD=your_app_password
ADMIN_EMAIL=your_email@gmail.com

# Koha DB
DB_HOST=197.211.6.51
DB_USER=library_read
DB_PASS=Library@5152
DB_NAME=koha_library

# Local DB
APP_SQLITE_PATH=./appdata.db

# Scheduler defaults
REPORT_SEND_DAY=1
REPORT_SEND_HOUR=8
REPORT_SEND_MINUTE=0

# UI
PAGE_SIZE=25
```

---

## â–¶ï¸ Running the Application

**Initialize the local database**

```bash
python appdata_init.py
```

**Start the Flask server**

```bash
flask run --host=0.0.0.0 --port=5000
```

Access the app â†’ [http://localhost:5000](http://localhost:5000)

---

## â° Scheduler & Automation

This system uses **Flask-APScheduler** for background task automation.

* Executes `send_all_reports(app)` from `tasks/monthly_reports.py`
* Fully configurable under **Admin â†’ Settings â†’ Email Settings**

**Supports:**

* Daily / Weekly / Monthly intervals
* Customizable execution time

---

## ğŸ“¬ Email Templates

| Template                       | Recipient | Description                       |
| ------------------------------ | --------- | --------------------------------- |
| `class_report_email.html`      | Teachers  | Monthly class performance reports |
| `department_report_email.html` | HODs      | Department-level summaries        |
| `password_reset_email.html`    | All users | Password reset with secure link   |

All templates use **responsive, branded HTML layouts** compatible with Gmail and Outlook.

---

## ğŸ” Roles & Permissions

| Role        | Access Scope            | Description                           |
| ----------- | ----------------------- | ------------------------------------- |
| **Admin**   | Full system control     | Manage users, schedules, and settings |
| **Teacher** | Class-level access      | View student and class reports        |
| **HOD**     | Department-level access | Analyze department data and trends    |

---

## ğŸ“Œ Notes

* Store student photos in `static/photos/` using **cardnumber** or **mapped ID** filenames.
* Koha DB credentials should be **read-only** for security.
* Gmail SMTP with 2FA requires an **App Password**.

---

## ğŸš€ Roadmap

* âœ… REST API for third-party integration
* ğŸ“ˆ Enhanced visual analytics and dashboards
* âš¡ Optimized reporting for large datasets
* ğŸ§  Activity logs and system monitoring

---

## ğŸ§‘â€ğŸ’» Author

**Patrick (Nyakwar-Orera)**
ğŸ“§ [GitHub Profile â†’](https://github.com/Nyakwar-Orera)

For issues or contributions:
ğŸ‘‰ [https://github.com/Nyakwar-Orera/Aljamea-Maktabat/issues](https://github.com/Nyakwar-Orera/Aljamea-Maktabat/issues)

---

## ğŸ›ï¸ License

This project is licensed under the **MIT License**.

---

