{% extends "base.html" %}
{% block title %}Login | Aljamea-tus-Saifiyah â€“ Library{% endblock %}

{% block content %}
<div class="login-shell">
  <div class="row w-100 shadow-lg rounded-4 overflow-hidden login-card">

    <!-- Left Side: Building / Islamic image -->
    <div class="col-md-6 d-none d-md-flex align-items-center justify-content-center login-hero">
      <!-- Replace Maktabat.jpg with any Islamic/library image if you like -->
      <img src="{{ url_for('static', filename='images/Maktabat.jpg') }}"
           alt="Aljamea-tus-Saifiyah â€“ Library"
           class="img-fluid login-hero-img">
    </div>

    <!-- Right Side: Login Form -->
    <div class="col-md-6 p-5">
      <h3 class="mb-1 text-center fw-bold login-title">
        <i class="bi bi-book-half me-2"></i> Aljamea-tus-Saifiyah â€“ Library
      </h3>
      <div class="text-center text-muted mb-3 small">
        Maktabat al-Jamea Portal
      </div>

      <!-- Avatar above username -->
      <div class="text-center mb-3">
        <img src="{{ url_for('static', filename='images/avatar.png') }}"
             alt="User avatar"
             class="login-avatar mb-2">
        <div class="login-subtitle">
          Welcome to the library portal
        </div>
      </div>

      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show small" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <!-- Login Form -->
      <!-- ðŸ” CHANGED: post to auth_bp.login -->
      <form method="post" action="{{ url_for('auth_bp.login') }}">
        <div class="mb-3">
          <label class="form-label fw-semibold text-muted">Username</label>
          <input name="username"
                 class="form-control form-control-lg rounded-pill border-0 shadow-sm px-4"
                 placeholder="Enter username"
                 required autofocus>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold text-muted">Password</label>
          <div class="position-relative">
            <input name="password"
                   type="password"
                   id="passwordInput"
                   class="form-control form-control-lg rounded-pill border-0 shadow-sm px-4 pe-5"
                   placeholder="Enter password"
                   required>
            <button type="button"
                    class="password-toggle-btn"
                    aria-label="Show or hide password">
              <i class="bi bi-eye-slash"></i>
            </button>
          </div>
        </div>

        <div class="d-grid gap-3 mt-4">
          <button class="btn text-white btn-lg rounded-pill shadow-sm"
                  type="submit"
                  style="background-color:var(--primary-color); border:none;">
            <i class="bi bi-box-arrow-in-right me-1"></i> Login
          </button>
          <button type="button"
                  class="btn btn-outline-secondary btn-lg rounded-pill shadow-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#helpModal">
            <i class="bi bi-question-circle me-1"></i> Help
          </button>
        </div>
      </form>

      <!-- Contact + Forgot Password -->
      <div class="text-center mt-4 small">
        <a href="{{ url_for('password_reset_bp.forgot_password') }}"
           class="text-decoration-none"
           style="color:var(--primary-color);">
          <i class="bi bi-lock me-1"></i>Forgot your password?
        </a>
      </div>

      <div class="text-center text-muted small mt-2">
        <i class="bi bi-envelope-at me-1"></i>
        Need help? Contact the library admin:
        <a href="mailto:{% if config and config.ADMIN_EMAIL %}{{ config.ADMIN_EMAIL }}{% else %}admin@maktabat.local{% endif %}"
           class="fw-semibold text-decoration-none"
           style="color:var(--primary-color);">
          {% if config and config.ADMIN_EMAIL %}
            {{ config.ADMIN_EMAIL }}
          {% else %}
            admin@maktabat.local
          {% endif %}
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 shadow">
      <div class="modal-header" style="background-color:var(--primary-color); color:#fff;">
        <h5 class="modal-title" id="helpModalLabel">
          <i class="bi bi-info-circle me-1"></i> Need Assistance?
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-2">If youâ€™re having trouble logging in:</p>
        <ul>
          <li>Ensure your username and password are correct.</li>
          <li>If forgotten, reset your password using the link provided.</li>
          <li>For further help, contact your library admin below.</li>
        </ul>
        <div class="mt-3">
          <strong>ðŸ“§ Admin Email:</strong><br>
          <a href="mailto:{% if config and config.ADMIN_EMAIL %}{{ config.ADMIN_EMAIL }}{% else %}admin@maktabat.local{% endif %}"
             class="text-decoration-none"
             style="color:var(--primary-color);">
            {% if config and config.ADMIN_EMAIL %}
              {{ config.ADMIN_EMAIL }}
            {% else %}
              admin@maktabat.local
            {% endif %}
          </a>
        </div>
      </div>
      <div class="modal-footer border-0">
        <button type="button"
                class="btn text-white rounded-pill shadow-sm px-4"
                data-bs-dismiss="modal"
                style="background-color:var(--primary-color);">
          <i class="bi bi-x-circle me-1"></i> Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Show / hide password -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('passwordInput');
    const btn = document.querySelector('.password-toggle-btn');
    if (!input || !btn) return;

    btn.addEventListener('click', function () {
      const isPassword = input.type === 'password';
      input.type = isPassword ? 'text' : 'password';

      const icon = btn.querySelector('i');
      if (icon) {
        icon.classList.toggle('bi-eye', isPassword);
        icon.classList.toggle('bi-eye-slash', !isPassword);
      }
    });
  });
</script>
{% endblock %}
