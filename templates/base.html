<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>{% block title %}Maktabat al-Jamea Dashboard{% endblock %}</title>

  <meta name="description" content="Maktabat al-Jamea â€” Library dashboard, reports, and analytics.">
  <meta name="theme-color" content="#a45a26">
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/apple-touch-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">

  <!-- Bootstrap & Datatables -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  {% block extra_css %}{% endblock %}

  <style>
    /* ===== Custom Theme ===== */
    .navbar-custom {
      background-color: #fff8ef;
      color: #a45a26;
      border-bottom: 1px solid #e6d8c3;
    }
    .navbar-custom .navbar-brand span {
      color: #a45a26;
      font-weight: 600;
      font-size: 1.1rem;
    }
    .navbar-custom .nav-link {
      color: #a45a26 !important;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    .navbar-custom .nav-link:hover,
    .navbar-custom .nav-link.active {
      color: #8c4519 !important;
      border-bottom: 2px solid #a45a26;
    }
    .navbar-custom .dropdown-menu {
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .navbar-custom .dropdown-item {
      color: #6b3b16;
    }
    .navbar-custom .dropdown-item:hover {
      background-color: #f5e9db;
    }
    .navbar-nav .nav-item {
      margin-right: 0.6rem;
    }

    .btn-outline-light {
      color: #a45a26;
      border-color: #a45a26;
    }
    .btn-outline-light:hover {
      background-color: #a45a26;
      color: #fff;
    }

    /* Footer */
    footer {
      background-color: #fff8ef;
      color: #6b3b16;
      border-top: 1px solid #e6d8c3;
      font-size: 0.9rem;
    }
    footer a {
      color: #a45a26;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body class="d-flex flex-column min-vh-100">

  {% if not hide_nav %}
  <nav class="navbar navbar-expand-lg navbar-custom shadow-sm sticky-top">
    <div class="container-fluid px-4">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <i class="bi bi-book-half fs-4 me-2"></i>
        <span>Maktabat Al-Jamea</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <!-- Left Links -->
        <ul class="navbar-nav ms-5 me-auto mb-2 mb-lg-0 gap-4">
          {% if session.get('logged_in') %}
            {% if session.get('role') == 'admin' %}
              <li class="nav-item">
                <a class="nav-link {% if 'dashboard_bp' in request.blueprint %}active{% endif %}"
                   href="{{ url_for('dashboard_bp.dashboard') }}">
                  <i class="bi bi-speedometer2 me-1"></i>Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if 'reports_bp' in request.blueprint %}active{% endif %}"
                   href="{{ url_for('reports_bp.reports_page') }}">
                  <i class="bi bi-table me-1"></i>Reports
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if 'admin_bp' in request.blueprint %}active{% endif %}"
                   href="{{ url_for('admin_bp.admin_settings') }}">
                  <i class="bi bi-gear me-1"></i>Settings
                </a>
              </li>

            {% elif session.get('role') == 'hod' %}
              <li class="nav-item">
                <a class="nav-link {% if 'hod_dashboard_bp' in request.blueprint %}active{% endif %}"
                   href="{{ url_for('hod_dashboard_bp.dashboard') }}">
                  <i class="bi bi-building me-1"></i>My Department
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if 'reports_bp' in request.blueprint %}active{% endif %}"
                   href="{{ url_for('reports_bp.reports_page') }}">
                  <i class="bi bi-graph-up me-1"></i>Reports
                </a>
              </li>

            {% elif session.get('role') == 'teacher' %}
              <li class="nav-item">
                <a class="nav-link {% if 'teacher_dashboard_bp' in request.blueprint %}active{% endif %}"
                   href="{{ url_for('teacher_dashboard_bp.dashboard') }}">
                  <i class="bi bi-people me-1"></i>My Class
                </a>
              </li>
            {% endif %}
          {% endif %}
        </ul>

        <!-- Right Links -->
        <ul class="navbar-nav align-items-center gap-3">
          {% if session.get('logged_in') %}
            <!-- Notifications -->
            <li class="nav-item position-relative">
              <a href="#" class="nav-link position-relative" title="Notifications" data-bs-toggle="dropdown">
                <i class="bi bi-bell fs-5"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notification-badge">3</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow" id="notification-dropdown">
                <li class="dropdown-header">Notifications</li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">New library books added</a></li>
                <li><a class="dropdown-item" href="#">You have overdue books</a></li>
                <li><a class="dropdown-item" href="#">Department meeting tomorrow</a></li>
                <li><a class="dropdown-item" href="#">More notifications...</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-center" href="#">View all</a></li>
              </ul>
            </li>
            
            <!-- Theme Toggle -->
            <li class="nav-item">
              <button class="btn btn-sm btn-outline-light" id="themeToggle" title="Toggle theme">
                <i class="bi bi-brightness-high"></i>
              </button>
            </li>
            
            <!-- Profile Dropdown with avatar -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                {% set nav_pic = session.get('profile_picture', 'images/avatar.png') %}
                <img src="{{ url_for('static', filename=nav_pic) }}"
                     alt="Profile"
                     class="nav-profile-avatar me-1">
                <span>{{ session.get('username', 'User') }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow">
                <li class="dropdown-header text-center">
                  <strong>{{ session.get('username', 'User') }}</strong><br>
                  <small class="text-muted text-capitalize">{{ session.get('role') }}</small>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('profile_bp.view_profile') }}">
                    <i class="bi bi-person"></i> View Profile
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('profile_bp.edit_profile') }}">
                    <i class="bi bi-pencil-square"></i> Edit Profile
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('profile_bp.change_password') }}">
                    <i class="bi bi-lock"></i> Change Password
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger" href="{{ url_for('auth_bp.logout') }}">
                    <i class="bi bi-box-arrow-right"></i> Logout
                  </a>
                </li>
              </ul>
            </li>
          {% else %}
            <li class="nav-item">
              <a class="btn btn-outline-light btn-sm" href="{{ url_for('auth_bp.login') }}">
                <i class="bi bi-person-lock me-1"></i>Login
              </a>
            </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>
  {% endif %}

  <main class="container mt-4 flex-grow-1 mb-5">
    {% block content %}{% endblock %}
  </main>

  {% if not hide_nav %}
  <footer class="mt-auto border-top py-2">
    <div class="container d-flex flex-wrap justify-content-between align-items-center small">
      <div>
        <strong>ðŸ“š Maktabat Al-Jamea</strong> â€¢ <span id="currentYear"></span> Â© All rights reserved
      </div>
      <div class="text-muted d-none d-sm-inline" id="currentDateTime"></div>
      <div>
        <a href="#">About</a> &nbsp;|&nbsp;
        <a href="#">Help</a> &nbsp;|&nbsp;
        <a href="#">Contact</a>
        <span class="text-muted ms-3">v2.0.0</span>
      </div>
    </div>
  </footer>
  {% endif %}

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js" defer></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js" defer></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>

  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const yearEl = document.getElementById('currentYear');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const dtEl = document.getElementById('currentDateTime');
      if (dtEl) {
        const fmt = new Intl.DateTimeFormat(undefined, {
          weekday: 'short', year: 'numeric', month: 'short', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit'
        });
        const tick = () => { dtEl.textContent = fmt.format(new Date()); };
        tick(); setInterval(tick, 1000);
      }

      const toggleBtn = document.getElementById('themeToggle');
      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          document.body.classList.toggle('bg-dark');
          document.body.classList.toggle('text-light');
        });
      }
    });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
